@model IsucorpTest.Model.ViewModel.ContactViewModel

@{
    ViewBag.Title = "New Contact";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">  
             
        @Html.ValidationSummary(true, "", new { @class = "text-danger"})
        
        <div id="clientErrors" style="display: none">             
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                        <input id="contactName" type="text" class="form-control" name="contactName" placeholder="Contact Full Name">
                    </div>
                </div>               
            </div>
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-tasks"></i></span>
                        <select id="contactType" class="form-control" name="contactType" placeholder="Phone Number"> 
                            @foreach (var item in Model.ListContactTypes)
                            {
                                <option value="@item.Id">
                                    @item.Name 
                                </option>                  
                            }                         
                        </select>
                        @Html.HiddenFor(model => model.ContactTypeId)                        
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-phone"></i></span>
                        <input id="phoneNumber" type="text" class="form-control" name="phoneNumber" placeholder="Phone Number">
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
                        <input id="birthDate" type="datetime" class="form-control" name="birthDate" placeholder="Birth Date">
                    </div>
                </div>
            </div>
        </div>
                          
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 noPadding">
                <div class="form-group">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <textarea id="contactDescription"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="form-group pull-right">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <input type="button" value="Save" class="btn btn-danger" id="btnAddContact"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts{   
    <script src="~/Scripts/tinymce/js/tinymce/tinymce.min.js"></script>   
    <script>
        var today = new Date();   
        $("#birthDate").datepicker({ dateFormat: "DD, MM d, yy" });
        $('#birthDate').datepicker("setDate", today);
        
        tinymce.init({
            selector: 'textarea',
            height: 500,
            theme: 'modern',
            plugins: 'print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount imagetools contextmenu colorpicker textpattern help',
            toolbar1: 'formatselect | bold italic strikethrough forecolor backcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat',
            image_advtab: true,
            templates: [
                { title: 'Test template 1', content: 'Test 1' },
                { title: 'Test template 2', content: 'Test 2' }
            ],
            content_css: [
                '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
                '//www.tinymce.com/css/codepen.min.css'
            ]
        });

        $(document).ready(function () {
            
            $("#ContactTypeId").val($('#contactType option:selected').val());
        });

        function GotoIndex() {
            alert("To the index");
        }

        $('#contactType').change(function () {
            $("#ContactTypeId").val($('#contactType option:selected').val());
        });

        //function toDate(dateStr) { //'mm-dd-yy'
        //    var parts = dateStr.split("/");
        //    return new Date(parts[2], parts[0] - 1, parts[1]);
        //}

        var data;     
        $('#btnAddContact').on("click",          
            function () {               
                var contactName = $("#contactName").val().trim();
                var contactBirthDate = $("#birthDate").datepicker("getDate");               
                if (contactName === "") {
                    $("#clientErrors").append('<label class="text-danger">Insert Contact Name</label>');                                     
                }
                if (contactBirthDate === today) {
                    $("#clientErrors").append('<label class="text-danger">Review Birth Date</label>');                                      
                }                
                else
                {
                    $("#clientErrors").hide();
                    data = {
                        Id: 0,
                        Name: contactName,
                        PhoneNumber: $("#phoneNumber").val().trim(),
                        BirthDate: $('#birthDate').datepicker({ dateFormat: 'mm-dd-yy' }).val(),
                        ContactTypeId: parseInt($("#ContactTypeId").val().trim()),                 
                        Description: tinymce.get('contactDescription').getContent()
                    }               
                    $.ajax({
                        type: 'POST',
                        url: '/Home/Add',
                        dataType: 'json',
                        data: { contact: data },
                        success: function (result) {                       
                            if (!result.success)
                                alert("There was an error adding the contact review data");
                            else
                                GotoIndex();
                        },
                        error: function (textStatus, errorThrown) {
                            console.log(textStatus);
                            console.log(errorThrown);
                        }
                    });               
                }
                $("#clientErrors").show();
            });                
    </script>           
}


